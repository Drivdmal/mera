<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мой профиль</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #d4efdf, #a8e063);
            color: #333;
            font-size: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            border-bottom: 4px solid #2c7a7b;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            background-color: rgba(255, 255, 255, 0.8);
        }

        .input-group {
            display: flex;
            align-items: center;
        }

        .input-group label {
            font-weight: bold;
            color: #2c7a7b;
            font-size: 18px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .input-group input, .input-group select {
            padding: 8px;
            border-radius: 8px;
            border: 2px solid #a8e063;
            background-color: rgba(255, 255, 255, 0.2);
            color: #333;
            font-size: 18px;
            width: 60px;
            text-align: center;
        }

        .input-group input[type="text"] {
            width: 150px;
        }

        .input-group select#lifestyle {
            width: 150px;
        }

        .calories-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .calories-info span {
            font-weight: bold;
            color: #2c7a7b;
            font-size: 24px;
        }

        .calories-info abbr {
            text-decoration: none;
            border-bottom: 1px dotted #2c7a7b;
            cursor: help;
        }

        .main-content {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 60%;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 40%;
        }

        .product-select {
            width: 100%;
            margin-bottom: 20px;
        }

        .product-select label {
            font-weight: bold;
            color: #2c7a7b;
            font-size: 18px;
            display: block;
            margin-bottom: 10px;
        }

        .product-select select {
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #a8e063;
            background-color: rgba(255, 255, 255, 0.2);
            color: #333;
            font-size: 18px;
            width: 100%;
        }

	h2 {
    		font-weight: bold;
    		color: #2c7a7b;
    		font-size: 20px;
    		margin-bottom: 10px;
		font-family: 'Comic Sans MS', 'Chalkboard SE', 'Comic Neue', sans-serif;
	}

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            font-size: 16px;
        }

        table th, table td {
            padding: 15px;
            text-align: center;
            color: #333;
        }

        table th {
            background-color: #a8e063;
            font-size: 14px;
        }

        table tbody tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.2);
        }

        table tfoot tr {
            background-color: #77CC00;
            color: #fff;
        }

        .chart-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .chart-box {
            width: 100%;
            height: 400px;
            position: relative;
        }

        canvas {
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .delete-button {
            background-color: #5599FF;
            color: #FFF;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 50px;
            margin-left: 10px;
            transition: background-color 0.3s ease;
        }

        .delete-button:hover {
            background-color: #98d65a;
        }

        .weight-input {
            width: 60px;
            margin-left: 10px;
        }

        .header {
            background-color: #d4efdf;
        }

        .input-group label, .product-select label, .calories-info span, .delete-button, .weight-input {
            color: #000000;
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="input-group">
            <label for="name">Имя:</label>
            <input type="text" id="name" value="Дмитрий">
        </div>
        <div class="input-group">
            <label for="age">Возраст:</label>
            <input type="number" id="age" value="38">
        </div>
        <div class="input-group">
            <label for="weight">Вес:</label>
            <input type="number" id="weight" value="147">
        </div>
        <div class="input-group">
            <label for="height">Рост:</label>
            <input type="number" id="height" value="174">
        </div>
        <div class="input-group">
            <label for="lifestyle">Активность:</label>
            <select id="lifestyle">
                <option value="1.2" selected>Малоподвижный</option>
                <option value="1.375">Умеренно активный</option>
                <option value="1.55">Активный</option>
                <option value="1.725">Очень активный</option>
            </select>
        </div>
        <div class="calories-info">
            <abbr title="Расчетный Суточный Калораж">РСК</abbr>
            <span id="daily-calories">0</span>
            <span>ккал</span>
        </div>
    </div>

    <div class="main-content">
        <div class="left-column">
            <div class="product-select">
                <label for="product">Выберите продукт:</label>
                <select id="product">
                    <option value="">-- Выберите продукт --</option>
                    <!-- Опции будут загружены из Excel файла -->
                </select>
            </div>

            <div>
                <h2 style="color: #111111;">Выбранные продукты</h2>
                <table id="selected-products">
                    <thead>
                        <tr>
                            <th>Продукт</th>
                            <th>Количество (г)</th>
                            <th>Белки (г)</th>
                            <th>Жиры (г)</th>
                            <th>Углеводы (г)</th>
                            <th>Калории (ккал)</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Строки будут добавляться динамически -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="2"><strong>Итого:</strong></td>
                            <td id="total-protein">0</td>
                            <td id="total-fat">0</td>
                            <td id="total-carbs">0</td>
                            <td id="total-calories">0</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div class="right-column">
            <div class="chart-container">
                <div class="chart-box">
                    <canvas id="nutritionChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Пример данных из Excel файла (можно заменить на загрузку из реального файла)
        const products = [
            { name: "Яблоко", protein: 0.3, fat: 0.2, carbs: 14, calories: 52 },
            { name: "Банан", protein: 1.1, fat: 0.3, carbs: 23, calories: 89 },
            { name: "Апельсин", protein: 0.9, fat: 0.1, carbs: 12, calories: 47 },
            { name: "Груша", protein: 0.4, fat: 0.1, carbs: 15, calories: 57 },
            { name: "Говядина", protein: 26.1, fat: 18.2, carbs: 0, calories: 250 },
            { name: "Свинина", protein: 20.8, fat: 16.4, carbs: 0, calories: 242 },
            { name: "Оливковое масло", protein: 0, fat: 100, carbs: 0, calories: 884 },
            { name: "Яйца перепела", protein: 13.1, fat: 11.5, carbs: 0.7, calories: 158 },
            { name: "Молоко", protein: 3.2, fat: 3.6, carbs: 4.8, calories: 60 },
            { name: "Творог", protein: 18, fat: 9, carbs: 3, calories: 143 },
            { name: "Черный хлеб", protein: 9, fat: 1.5, carbs: 49, calories: 215 },
            { name: "Картофель", protein: 2, fat: 0.1, carbs: 17, calories: 77 }
        ];

        // Заполнение выпадающего списка
        const productSelect = document.getElementById('product');
        products.forEach(product => {
            const option = document.createElement('option');
            option.value = JSON.stringify(product);
            option.textContent = product.name;
            productSelect.appendChild(option);
        });

        // Обработка выбора продукта
        const selectedProductsTable = document.getElementById('selected-products').getElementsByTagName('tbody')[0];
        const totalProtein = document.getElementById('total-protein');
        const totalFat = document.getElementById('total-fat');
        const totalCarbs = document.getElementById('total-carbs');
        const totalCalories = document.getElementById('total-calories');

        productSelect.addEventListener('change', function() {
            const selectedProduct = JSON.parse(this.value);
            if (selectedProduct) {
                const newRow = selectedProductsTable.insertRow();
                const cell1 = newRow.insertCell(0);
                const cell2 = newRow.insertCell(1);
                const cell3 = newRow.insertCell(2);
                const cell4 = newRow.insertCell(3);
                const cell5 = newRow.insertCell(4);
                const cell6 = newRow.insertCell(5);
                const cell7 = newRow.insertCell(6);
                cell1.textContent = selectedProduct.name;
                cell2.innerHTML = `<input type="range" min="0" max="5000" step="10" value="100" class="weight-slider" style="width: 100px;">
                                    <input type="number" min="0" max="5000" step="1" value="100" class="weight-input" style="width: 60px;">`;
                const slider = cell2.querySelector('.weight-slider');
                const input = cell2.querySelector('.weight-input');

                slider.addEventListener('input', function() {
                    input.value = slider.value;
                    updateRow(newRow, selectedProduct);
                    updateTotals();
                    updateCharts();
                });

                input.addEventListener('input', function() {
                    slider.value = input.value;
                    updateRow(newRow, selectedProduct);
                    updateTotals();
                    updateCharts();
                });

                input.addEventListener('mousewheel', function(event) {
                    event.preventDefault();
                    input.value = parseInt(input.value) + (event.deltaY > 0 ? -1 : 1);
                    slider.value = input.value;
                    updateRow(newRow, selectedProduct);
                    updateTotals();
                    updateCharts();
                });

                cell3.textContent = (selectedProduct.protein / 100 * 100).toFixed(1);
                cell4.textContent = (selectedProduct.fat / 100 * 100).toFixed(1);
                cell5.textContent = (selectedProduct.carbs / 100 * 100).toFixed(1);
                cell6.textContent = (selectedProduct.calories / 100 * 100).toFixed(1);
                cell7.innerHTML = `<button class="delete-button">Удалить</button>`;
                cell7.querySelector('button').addEventListener('click', function() {
                    selectedProductsTable.deleteRow(newRow.rowIndex - 1);
                    updateTotals();
                    updateCharts();
                });

                // Обновление итогов
                updateTotals();
                updateCharts();
            }
        });

        function updateRow(row, product) {
            const quantity = row.cells[1].querySelector('.weight-input').value;
            row.cells[2].textContent = (product.protein / 100 * quantity).toFixed(1);
            row.cells[3].textContent = (product.fat / 100 * quantity).toFixed(1);
            row.cells[4].textContent = (product.carbs / 100 * quantity).toFixed(1);
            row.cells[5].textContent = (product.calories / 100 * quantity).toFixed(1);
        }

        function updateTotals() {
            const rows = selectedProductsTable.getElementsByTagName('tr');
            let totalProteinValue = 0;
            let totalFatValue = 0;
            let totalCarbsValue = 0;
            let totalCaloriesValue = 0;

            for (let i = 0; i < rows.length; i++) {
                totalProteinValue += parseFloat(rows[i].cells[2].textContent);
                totalFatValue += parseFloat(rows[i].cells[3].textContent);
                totalCarbsValue += parseFloat(rows[i].cells[4].textContent);
                totalCaloriesValue += parseFloat(rows[i].cells[5].textContent);
            }

            totalProtein.textContent = totalProteinValue.toFixed(1);
            totalFat.textContent = totalFatValue.toFixed(1);
            totalCarbs.textContent = totalCarbsValue.toFixed(1);
            totalCalories.textContent = totalCaloriesValue.toFixed(1);
        }

        // Расчет суточной потребности в калориях
        const weightInput = document.getElementById('weight');
        const heightInput = document.getElementById('height');
        const ageInput = document.getElementById('age');
        const lifestyleSelect = document.getElementById('lifestyle');
        const dailyCalories = document.getElementById('daily-calories');

        function calculateDailyCalories() {
            const weight = parseFloat(weightInput.value);
            const height = parseFloat(heightInput.value);
            const age = parseFloat(ageInput.value);
            const lifestyle = parseFloat(lifestyleSelect.value);

            if (weight && height && age && lifestyle) {
                // Формула Харриса-Бенедикта для мужчин
                const bmr = 88.36 + (13.4 * weight) + (4.8 * height) - (5.7 * age);
                const dailyCaloriesNeeded = bmr * lifestyle;
                dailyCalories.textContent = Math.round(dailyCaloriesNeeded);

                // Обновление графиков
                updateCharts();
            }
        }

        weightInput.addEventListener('input', calculateDailyCalories);
        heightInput.addEventListener('input', calculateDailyCalories);
        ageInput.addEventListener('input', calculateDailyCalories);
        lifestyleSelect.addEventListener('change', calculateDailyCalories);

        // Графики
        const nutritionCtx = document.getElementById('nutritionChart').getContext('2d');

        let nutritionChart = new Chart(nutritionCtx, {
            type: 'bar',
            data: {
                labels: ['Белки', 'Жиры', 'Углеводы', 'Калории'],
                datasets: [
                    {
                        label: 'Целевые значения',
                        data: [1, 1, 1, 1],
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Текущие значения',
                        data: [0, 0, 0, 0],
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 1
                    }
                }
            }
        });

        function updateCharts() {
            const dailyCaloriesNeeded = parseFloat(dailyCalories.textContent);
            const targetProtein = (dailyCaloriesNeeded * 0.3) / 4;
            const targetFat = (dailyCaloriesNeeded * 0.3) / 9;
            const targetCarbs = (dailyCaloriesNeeded * 0.4) / 4;

            const currentProtein = parseFloat(totalProtein.textContent);
            const currentFat = parseFloat(totalFat.textContent);
            const currentCarbs = parseFloat(totalCarbs.textContent);
            const currentCalories = parseFloat(totalCalories.textContent);

            nutritionChart.data.datasets[1].data = [
                currentProtein / targetProtein,
                currentFat / targetFat,
                currentCarbs / targetCarbs,
                currentCalories / dailyCaloriesNeeded
            ];

            nutritionChart.update();
        }

        // Расчет суточной потребности в калориях при загрузке страницы
        calculateDailyCalories();
    </script>

</body>
</html>
